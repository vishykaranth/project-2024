# Scalability Patterns - Complete Diagrams Guide (Part 4: Caching)

## ğŸ’¾ Caching: Multi-Level Caching & Cache Invalidation Strategies

---

## 1. Caching Overview

### Caching Concept
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Caching Concept                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Without Cache:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Client  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚ Request
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Server  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚ Query Database
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Database â”‚  â† Slow (100-500ms)
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ Response
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Client  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

With Cache:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Client  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚ Request
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Server  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚ Check Cache
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Cache   â”‚  â† Fast (1-5ms)
    â”‚  (Hit)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ Response
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Client  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Benefits:
- 10-100x faster response
- Reduced database load
- Better scalability
- Lower latency
```

---

## 2. Multi-Level Caching Architecture

### Cache Hierarchy
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Multi-Level Cache Architecture                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Level 1: Browser Cache (Client-Side)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Browser  â”‚
    â”‚  Cache   â”‚  â† Fastest (0ms)
    â”‚          â”‚     Smallest (KB)
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Cache Miss
         â–¼
Level 2: CDN Cache (Edge)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   CDN    â”‚
    â”‚  Cache   â”‚  â† Very Fast (10-50ms)
    â”‚          â”‚     Medium (MB-GB)
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Cache Miss
         â–¼
Level 3: Application Cache (In-Memory)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   App    â”‚
    â”‚  Cache   â”‚  â† Fast (1-5ms)
    â”‚ (Redis,  â”‚     Large (GB)
    â”‚ Memcached)â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Cache Miss
         â–¼
Level 4: Database Cache (Query Cache)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Database â”‚
    â”‚  Cache   â”‚  â† Moderate (10-50ms)
    â”‚          â”‚     Very Large (GB-TB)
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Cache Miss
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Database â”‚
    â”‚  Disk    â”‚  â† Slowest (100-500ms)
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Cache Characteristics:
Level  Speed    Size      Location      Use Case
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
L1     0ms      KB        Browser       Static assets
L2     10-50ms  MB-GB     CDN           Static content
L3     1-5ms    GB        App Server    Dynamic data
L4     10-50ms  GB-TB     Database      Query results
```

### Multi-Level Cache Flow
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Cache Request Flow                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Request: GET /api/users/123

Step 1: Browser Cache
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Browser  â”‚
    â”‚  Cache   â”‚  â† Check local cache
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€ Hit â”€â”€â”€â”€â–º Return (0ms) âœ“
         â”‚
         â””â”€â”€â”€ Miss â”€â”€â”€â–º Continue
              â”‚
              â–¼
Step 2: CDN Cache
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   CDN    â”‚
    â”‚  Cache   â”‚  â† Check edge cache
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€ Hit â”€â”€â”€â”€â–º Return (20ms) âœ“
         â”‚
         â””â”€â”€â”€ Miss â”€â”€â”€â–º Continue
              â”‚
              â–¼
Step 3: Application Cache
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   App    â”‚
    â”‚  Cache   â”‚  â† Check Redis/Memcached
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€ Hit â”€â”€â”€â”€â–º Return (2ms) âœ“
         â”‚                Store in CDN
         â”‚
         â””â”€â”€â”€ Miss â”€â”€â”€â–º Continue
              â”‚
              â–¼
Step 4: Database Cache
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Database â”‚
    â”‚  Cache   â”‚  â† Check query cache
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€ Hit â”€â”€â”€â”€â–º Return (15ms) âœ“
         â”‚                Store in App Cache
         â”‚
         â””â”€â”€â”€ Miss â”€â”€â”€â–º Query Database
              â”‚
              â–¼
Step 5: Database
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Database â”‚
    â”‚  Disk    â”‚  â† Query disk
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ Return (200ms)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Store   â”‚  â† Store in all caches
    â”‚  in all  â”‚     for next request
    â”‚  levels  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Cache Patterns

### Cache-Aside (Lazy Loading)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Cache-Aside Pattern                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Read Flow:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  App     â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚ 1. Check Cache
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Cache   â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€ Hit â”€â”€â”€â”€â–º Return to App âœ“
         â”‚
         â””â”€â”€â”€ Miss â”€â”€â”€â–º Continue
              â”‚
              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  App      â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚ 2. Query Database
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Database â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚ 3. Return Data
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  App      â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚ 4. Store in Cache
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Cache   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ 5. Return to Client
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Client  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Write Flow:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  App     â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚ 1. Write to Database
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Database â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚ 2. Success
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  App     â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚ 3. Invalidate Cache
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Cache   â”‚  â† Delete/Update
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Pros:                    Cons:
âœ“ Simple                 âœ— Cache miss penalty
âœ“ Cache failure OK       âœ— Stale data possible
âœ“ Flexible               âœ— Two round trips
```

### Read-Through Cache
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Read-Through Pattern                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Read Flow:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  App     â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚ 1. Request from Cache
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Cache    â”‚
    â”‚  Library  â”‚  â† Cache handles DB access
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€ Hit â”€â”€â”€â”€â–º Return to App âœ“
         â”‚
         â””â”€â”€â”€ Miss â”€â”€â”€â–º Cache Library
              â”‚              â”‚
              â”‚              â–¼
              â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚         â”‚Database â”‚
              â”‚         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
              â”‚              â”‚
              â”‚              â–¼
              â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚         â”‚  Cache   â”‚
              â”‚         â”‚  Library â”‚
              â”‚         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
              â”‚              â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼ Return to App
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  App     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Benefits:
- App doesn't know about DB
- Cache library handles everything
- Automatic cache population
- Consistent behavior
```

### Write-Through Cache
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Write-Through Pattern                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Write Flow:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  App     â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚ 1. Write to Cache
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Cache    â”‚
    â”‚  Library  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚ 2. Write to Database
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Database â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚ 3. Success
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Cache    â”‚
    â”‚  Library  â”‚  â† Update cache
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚ 4. Return Success
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  App     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Benefits:
- Cache always consistent
- No stale data
- Write is slower (two writes)
- Good for critical data
```

### Write-Behind (Write-Back) Cache
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Write-Behind Pattern                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Write Flow:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  App     â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚ 1. Write to Cache
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Cache    â”‚
    â”‚  Library  â”‚  â† Write immediately
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚ 2. Return Success (fast)
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  App     â”‚  â† App gets response
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    (Background)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Cache    â”‚
    â”‚  Library  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚ 3. Write to Database (async)
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Database â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Benefits:
- Very fast writes
- Batched DB writes
- Better performance

Risks:
- Data loss if cache fails
- Eventual consistency
- Complex implementation
```

---

## 4. Cache Invalidation Strategies

### Time-Based Expiration (TTL)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              TTL-Based Expiration                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Cache   â”‚
    â”‚          â”‚
    â”‚  Key: user:123
    â”‚  Value: {name: "John"}
    â”‚  TTL: 3600s (1 hour)
    â”‚  Created: 10:00 AM
    â”‚  Expires: 11:00 AM
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Time passes...
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Cache   â”‚
    â”‚          â”‚
    â”‚  Key: user:123
    â”‚  Status: EXPIRED
    â”‚  Time: 11:01 AM
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ Next Request
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Cache   â”‚
    â”‚          â”‚  â† Refresh from DB
    â”‚  Key: user:123
    â”‚  Value: {name: "John"}
    â”‚  TTL: 3600s
    â”‚  Created: 11:01 AM
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TTL Selection:
- Static data: Long TTL (24 hours)
- Dynamic data: Short TTL (5-15 minutes)
- User data: Medium TTL (1 hour)
- Real-time data: Very short TTL (1 minute)
```

### Event-Based Invalidation
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Event-Based Invalidation                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Update Flow:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  App     â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚ 1. Update User
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Database â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚ 2. Publish Event
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Event    â”‚
    â”‚ Bus      â”‚  â† user.updated event
    â”‚ (Kafka)  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â–º Cache Service
         â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚    â”‚  Cache   â”‚
         â”‚    â”‚  Invalidateâ”‚
         â”‚    â”‚  user:123â”‚
         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â””â”€â”€â”€â–º Other Services
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Cache   â”‚
              â”‚  Invalidateâ”‚
              â”‚  user:123â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Event Types:
- user.updated â†’ Invalidate user cache
- product.updated â†’ Invalidate product cache
- order.created â†’ Invalidate user orders cache
- price.changed â†’ Invalidate price cache
```

### Invalidation Patterns
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Cache Invalidation Patterns                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. Delete on Write:
    Write â”€â”€â–º Delete Cache Key
    Next read â”€â”€â–º Cache miss â”€â”€â–º Load from DB

2. Update on Write:
    Write â”€â”€â–º Update Cache Key
    Next read â”€â”€â–º Cache hit âœ“

3. Tag-Based Invalidation:
    Cache Keys:
    - user:123 â†’ Tag: user
    - user:123:orders â†’ Tag: user, orders
    - product:456 â†’ Tag: product
    
    Invalidate by Tag:
    - Invalidate "user" â†’ Removes all user:* keys
    - Invalidate "orders" â†’ Removes all *:orders keys

4. Version-Based Invalidation:
    Cache Key: user:123:v2
    Update â”€â”€â–º user:123:v3
    Old version expires naturally
```

---

## 5. Cache Topologies

### Distributed Cache (Redis Cluster)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Redis Cluster Topology                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  App 1   â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â–º Redis Node 1 (Shard 0-5460)
         â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  App 2   â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â–º Redis Node 2 (Shard 5461-10922)
         â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  App 3   â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚
         â””â”€â”€â”€â–º Redis Node 3 (Shard 10923-16383)

Hash Slot Distribution:
- Key "user:123" â†’ Hash â†’ Slot 5000 â†’ Node 1
- Key "product:456" â†’ Hash â†’ Slot 8000 â†’ Node 2
- Key "order:789" â†’ Hash â†’ Slot 12000 â†’ Node 3

Benefits:
- Horizontal scaling
- High availability
- Data sharding
- Load distribution
```

### Cache Replication
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Cache Replication                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Master  â”‚
    â”‚  Cache   â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â–º Replica 1
         â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚    â”‚  Read    â”‚
         â”‚    â”‚  Replica â”‚
         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â””â”€â”€â”€â–º Replica 2
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Read    â”‚
              â”‚  Replica â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Read Distribution:
- Writes: Master only
- Reads: Master + Replicas
- Load balancing across replicas

Failover:
- Master fails â†’ Promote replica
- Automatic failover
- High availability
```

---

## 6. Cache Warming and Preloading

### Cache Warming Strategy
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Cache Warming                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Cold Start Problem:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Cache   â”‚  â† Empty cache
    â”‚  (Cold)  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ First requests
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Database â”‚  â† All requests hit DB
    â”‚  (High   â”‚     (slow, overloaded)
    â”‚   Load)  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Solution: Cache Warming
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Warm-up  â”‚
    â”‚  Script  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â–º Load popular data
         â”œâ”€â”€â”€â–º Pre-compute results
         â”œâ”€â”€â”€â–º Load user sessions
         â””â”€â”€â”€â–º Load frequently accessed data
              â”‚
              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Cache   â”‚  â† Pre-populated
    â”‚  (Warm)  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Warming Strategies:
1. On Startup: Load critical data
2. Scheduled: Refresh during low traffic
3. Predictive: Pre-load based on patterns
4. Background: Continuous warm-up
```

---

## Key Takeaways

### Caching Best Practices
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Best Practices                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ“ Multi-Level Caching
  - Browser â†’ CDN â†’ App â†’ Database
  - Each level serves different purpose

âœ“ Appropriate TTL
  - Match data volatility
  - Balance freshness vs performance

âœ“ Cache Invalidation
  - Event-based for critical data
  - TTL-based for less critical
  - Tag-based for related data

âœ“ Cache Keys
  - Meaningful names
  - Include version
  - Consistent format

âœ“ Monitoring
  - Hit/miss ratios
  - Cache size
  - Eviction rates
  - Response times

âœ“ Failover Strategy
  - Cache failures shouldn't break app
  - Graceful degradation
  - Fallback to database
```

---

**Next: Part 5 will cover Database Scaling with read replicas, sharding, and partitioning.**

