# Distributed Systems Challenges - Part 1: Network Partitions

## ğŸŒ Network Partitions: Split-Brain, Quorum, Majority Consensus

---

## 1. Network Partition Overview

### What is a Network Partition?
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Network Partition Scenario                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Before Partition:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Node A   â”‚â—„â”€â”€â”€â”€â–ºâ”‚ Node B   â”‚â—„â”€â”€â”€â”€â–ºâ”‚ Node C   â”‚
    â”‚          â”‚      â”‚          â”‚      â”‚          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                 â”‚                 â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    Network

After Partition:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Node A   â”‚              â”‚ Node B   â”‚      â”‚ Node C   â”‚
    â”‚          â”‚              â”‚          â”‚      â”‚          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                         â”‚                 â”‚
         â”‚                         â”‚                 â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚ Cluster â”‚              â”‚ Cluster   â”‚      â”‚ Cluster â”‚
    â”‚   1     â”‚              â”‚    2      â”‚      â”‚    3    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    âŒ Cannot communicate with each other
    âœ… Each cluster thinks it's the only one
    âš ï¸  Split-brain problem occurs
```

### Types of Network Partitions
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Partition Types                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. Complete Partition:
   Cluster A  â”‚  â”‚  Cluster B
   (isolated) â”‚  â”‚  (isolated)
   
2. Partial Partition:
   Node A â”€â”€â–º Node B  â”‚  â”‚  Node C â”€â”€â–º Node D
   
3. Cascading Failures:
   Node A fails â†’ Network congestion â†’ More nodes isolated
```

---

## 2. Split-Brain Problem

### Split-Brain Scenario
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Split-Brain Problem                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Normal State (5 nodes):
    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”
    â”‚ N1 â”‚â—„â”€â”€â–ºâ”‚ N2 â”‚â—„â”€â”€â–ºâ”‚ N3 â”‚â—„â”€â”€â–ºâ”‚ N4 â”‚â—„â”€â”€â–ºâ”‚ N5 â”‚
    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜
         â”‚         â”‚         â”‚         â”‚         â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              All nodes can communicate

After Partition:
    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”
    â”‚ N1 â”‚â—„â”€â”€â–ºâ”‚ N2 â”‚              â”‚ N3 â”‚â—„â”€â”€â–ºâ”‚ N4 â”‚â—„â”€â”€â–ºâ”‚ N5 â”‚
    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜
         â”‚         â”‚                   â”‚         â”‚         â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      Cluster A (2 nodes)            Cluster B (3 nodes)
      
      âŒ Problem: Both clusters think they're the primary
      âŒ Both accept writes â†’ Data inconsistency
      âŒ Both serve traffic â†’ Duplicate operations
```

### Split-Brain Consequences
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Split-Brain Consequences                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Cluster A (2 nodes):          Cluster B (3 nodes):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Primary: N1     â”‚         â”‚  Primary: N3     â”‚
â”‚  Accepts writes  â”‚         â”‚  Accepts writes  â”‚
â”‚  Serves traffic  â”‚         â”‚  Serves traffic   â”‚
â”‚                  â”‚         â”‚                   â”‚
â”‚  Data:           â”‚         â”‚  Data:            â”‚
â”‚  Key1 = "A"     â”‚         â”‚  Key1 = "B"       â”‚
â”‚  Key2 = "X"     â”‚         â”‚  Key2 = "Y"       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                            â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
            When partition heals:
            âŒ Conflicting data
            âŒ Lost writes
            âŒ Inconsistent state
```

### Split-Brain Example: Database Cluster
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Database Split-Brain                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Partition 1:                    Partition 2:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DB Master   â”‚              â”‚  DB Master   â”‚
â”‚  (thinks it'sâ”‚              â”‚  (thinks it'sâ”‚
â”‚   primary)   â”‚              â”‚   primary)   â”‚
â”‚              â”‚              â”‚              â”‚
â”‚  Write:      â”‚              â”‚  Write:      â”‚
â”‚  UPDATE user â”‚              â”‚  UPDATE user â”‚
â”‚  SET balance â”‚              â”‚  SET balance â”‚
â”‚  = 1000      â”‚              â”‚  = 2000      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

After partition heals:
âŒ Which write is correct?
âŒ Data corruption
âŒ Lost transactions
```

---

## 3. Quorum-Based Solutions

### Quorum Concept
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Quorum Mechanism                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Total Nodes: 5
Quorum: 3 (majority = âŒŠ5/2âŒ‹ + 1)

    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”
    â”‚ N1 â”‚    â”‚ N2 â”‚    â”‚ N3 â”‚    â”‚ N4 â”‚    â”‚ N5 â”‚
    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜
    
Quorum = Majority of nodes must agree
- Write requires quorum (3 nodes)
- Read requires quorum (3 nodes)
- Prevents split-brain (only one side can have quorum)
```

### Quorum in Action
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Quorum Prevents Split-Brain                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

After Partition:
    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”
    â”‚ N1 â”‚â—„â”€â”€â–ºâ”‚ N2 â”‚              â”‚ N3 â”‚â—„â”€â”€â–ºâ”‚ N4 â”‚â—„â”€â”€â–ºâ”‚ N5 â”‚
    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜
     2 nodes (NO QUORUM)           3 nodes (HAS QUORUM)
     
     âŒ Cannot accept writes      âœ… Can accept writes
     âŒ Cannot serve reads        âœ… Can serve reads
     âš ï¸  Goes into read-only mode  âœ… Continues operations
     
Result: Only one side can operate â†’ No split-brain!
```

### Quorum Calculation
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Quorum Formulas                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

For N nodes:
Quorum = âŒŠN/2âŒ‹ + 1

Examples:
N = 3: Quorum = âŒŠ3/2âŒ‹ + 1 = 1 + 1 = 2
N = 5: Quorum = âŒŠ5/2âŒ‹ + 1 = 2 + 1 = 3
N = 7: Quorum = âŒŠ7/2âŒ‹ + 1 = 3 + 1 = 4

Properties:
- At least one side will have quorum
- At most one side can have quorum
- Prevents split-brain scenarios
```

### Quorum Read/Write
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Quorum Read/Write Operations                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Write Operation:
    Client
      â”‚
      â”‚ Write request
      â–¼
    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”
    â”‚ N1 â”‚    â”‚ N2 â”‚    â”‚ N3 â”‚    â”‚ N4 â”‚    â”‚ N5 â”‚
    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜
      â”‚         â”‚         â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      Send to 3 nodes (quorum)
      
      âœ… All 3 acknowledge â†’ Write successful
      âŒ < 3 acknowledge â†’ Write failed

Read Operation:
    Client
      â”‚
      â”‚ Read request
      â–¼
    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”
    â”‚ N1 â”‚    â”‚ N2 â”‚    â”‚ N3 â”‚    â”‚ N4 â”‚    â”‚ N5 â”‚
    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜
      â”‚         â”‚         â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      Read from 3 nodes (quorum)
      
      âœ… Get latest value from majority
      âœ… Detect inconsistencies
```

---

## 4. Majority Consensus

### Majority Consensus Algorithm
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Majority Consensus                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Raft Consensus (Example):

Leader Election:
    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”
    â”‚ N1 â”‚    â”‚ N2 â”‚    â”‚ N3 â”‚    â”‚ N4 â”‚    â”‚ N5 â”‚
    â”‚(L) â”‚â—„â”€â”€â”€â”‚(F) â”‚â—„â”€â”€â”€â”‚(F) â”‚â—„â”€â”€â”€â”‚(F) â”‚â—„â”€â”€â”€â”‚(F) â”‚
    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜
     Leader    Follower  Follower  Follower  Follower
     
Write Flow:
1. Client â†’ Leader (N1)
2. Leader â†’ Majority (N2, N3, N4, N5)
3. Majority acknowledges (N2, N3, N4)
4. Leader commits
5. Leader â†’ Client (success)
```

### Majority Consensus States
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Node States in Consensus                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Leader:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Leader  â”‚
    â”‚          â”‚
    â”‚  â€¢ Handles client requests
    â”‚  â€¢ Replicates to followers
    â”‚  â€¢ Commits after majority
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Follower:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Follower â”‚
    â”‚          â”‚
    â”‚  â€¢ Receives updates
    â”‚  â€¢ Acknowledges leader
    â”‚  â€¢ Can become candidate
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Candidate:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Candidate â”‚
    â”‚          â”‚
    â”‚  â€¢ Requests votes
    â”‚  â€¢ Needs majority votes
    â”‚  â€¢ Becomes leader or follower
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Majority Consensus During Partition
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Partition Handling                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Before Partition (5 nodes):
    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”
    â”‚ L  â”‚â—„â”€â”€â–ºâ”‚ F  â”‚â—„â”€â”€â–ºâ”‚ F  â”‚â—„â”€â”€â–ºâ”‚ F  â”‚â—„â”€â”€â–ºâ”‚ F  â”‚
    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜
     Leader

After Partition:
    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”
    â”‚ L  â”‚â—„â”€â”€â–ºâ”‚ F  â”‚              â”‚ F  â”‚â—„â”€â”€â–ºâ”‚ F  â”‚â—„â”€â”€â–ºâ”‚ F  â”‚
    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜
    2 nodes                        3 nodes
    âŒ No majority                 âœ… Has majority
    âš ï¸  Leader steps down          âœ… New leader elected
    âš ï¸  No writes accepted          âœ… Writes accepted
    
Result: Only majority side operates
```

---

## 5. Practical Examples

### Example 1: Distributed Database (Cassandra)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Cassandra Quorum                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Replication Factor: 3
Consistency Level: QUORUM (2 nodes)

Write:
    Client
      â”‚
      â”‚ Write to 3 replicas
      â–¼
    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”
    â”‚ N1 â”‚    â”‚ N2 â”‚    â”‚ N3 â”‚
    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜
      â”‚         â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      Wait for 2 acknowledgements (quorum)
      
      âœ… 2/3 acknowledge â†’ Success
      âœ… Data replicated to majority

Read:
    Client
      â”‚
      â”‚ Read from 3 replicas
      â–¼
    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”
    â”‚ N1 â”‚    â”‚ N2 â”‚    â”‚ N3 â”‚
    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜
      â”‚         â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      Get value from 2 nodes (quorum)
      
      âœ… Return latest timestamp value
      âœ… Detect conflicts
```

### Example 2: ZooKeeper
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ZooKeeper Quorum                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ZooKeeper Cluster (5 nodes):
    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”
    â”‚ Z1 â”‚    â”‚ Z2 â”‚    â”‚ Z3 â”‚    â”‚ Z4 â”‚    â”‚ Z5 â”‚
    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜
      â”‚         â”‚         â”‚         â”‚         â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      
Quorum = 3 (majority)

Leader Election:
- Nodes vote for leader
- Need 3 votes to become leader
- Only one can get 3 votes

Write Operations:
- Leader receives write
- Replicates to followers
- Commits after 3 acknowledgements
```

### Example 3: etcd (Raft)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              etcd Raft Consensus                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

etcd Cluster (3 nodes):
    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”
    â”‚ L  â”‚â—„â”€â”€â–ºâ”‚ F  â”‚â—„â”€â”€â–ºâ”‚ F  â”‚
    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜
     Leader   Follower  Follower
     
Quorum = 2 (majority of 3)

Write Flow:
1. Client â†’ Leader
2. Leader â†’ Followers (2)
3. 2/2 acknowledge â†’ Commit
4. Leader â†’ Client (success)

Partition Scenario:
    â”Œâ”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”
    â”‚ L  â”‚              â”‚ F  â”‚â—„â”€â”€â–ºâ”‚ F  â”‚
    â””â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜
    1 node              2 nodes
    âŒ No quorum        âœ… Has quorum
    âš ï¸  No writes        âœ… New leader elected
```

---

## 6. Quorum Variants

### Read Quorum vs Write Quorum
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Quorum Variants                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

R + W > N:  (Strong consistency)
    R = Read quorum
    W = Write quorum
    N = Total replicas
    
Example: N=5, R=3, W=3
    âœ… 3 + 3 = 6 > 5
    âœ… Always overlap
    âœ… Strong consistency

R + W â‰¤ N:  (Eventual consistency)
    Example: N=5, R=2, W=2
    âš ï¸  2 + 2 = 4 â‰¤ 5
    âš ï¸  May not overlap
    âš ï¸  Eventual consistency
```

### Quorum Types
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Quorum Types                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. Simple Majority:
   Quorum = âŒŠN/2âŒ‹ + 1
   
2. Weighted Quorum:
   Nodes have different weights
   Quorum = Sum of weights > 50%
   
3. Hierarchical Quorum:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Region1 â”‚  (3 nodes)
   â”‚  Region2 â”‚  (3 nodes)
   â”‚  Region3 â”‚  (3 nodes)
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   Quorum = Majority of regions
```

---

## 7. Handling Partitions

### Partition Detection
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Partition Detection                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Heartbeat Mechanism:
    â”Œâ”€â”€â”€â”€â”
    â”‚ N1 â”‚â”€â”€â”€â–º Heartbeat every T seconds
    â””â”€â”€â”€â”€â”˜      â”‚
                â”‚
                â–¼
    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”
    â”‚ N2 â”‚    â”‚ N3 â”‚    â”‚ N4 â”‚
    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜
    
Timeout Detection:
- If no heartbeat for 2T â†’ Partition detected
- Node marks others as unreachable
- Triggers quorum check
```

### Partition Recovery
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Partition Recovery                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

When Partition Heals:
    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”
    â”‚ N1 â”‚â—„â”€â”€â–ºâ”‚ N2 â”‚              â”‚ N3 â”‚â—„â”€â”€â–ºâ”‚ N4 â”‚â—„â”€â”€â–ºâ”‚ N5 â”‚
    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜
      â”‚         â”‚                   â”‚         â”‚         â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      
Recovery Steps:
1. Detect partition healed
2. Exchange state information
3. Compare versions/timestamps
4. Resolve conflicts (last-write-wins or merge)
5. Sync data from majority side
6. Resume normal operations
```

---

## Key Takeaways

### Summary
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Key Concepts                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. Network Partition:
   - Nodes cannot communicate
   - Creates isolated clusters
   
2. Split-Brain:
   - Multiple clusters think they're primary
   - Causes data inconsistency
   - Prevents by quorum/majority
   
3. Quorum:
   - Majority of nodes must agree
   - Prevents split-brain
   - Ensures consistency
   
4. Majority Consensus:
   - Only majority side operates
   - Leader election requires majority
   - Writes require majority acknowledgment
```

### Best Practices
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Best Practices                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… Always use odd number of nodes (3, 5, 7)
âœ… Set quorum = majority (âŒŠN/2âŒ‹ + 1)
âœ… Implement heartbeat for partition detection
âœ… Use version vectors/timestamps for conflict resolution
âœ… Monitor partition events and recovery
âœ… Test partition scenarios in staging
```

---

**Next: Part 2 will cover Clock Synchronization (NTP, Logical Clocks, Vector Clocks)**

